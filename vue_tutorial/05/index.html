<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Vuexを使う</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous" />
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.0.0/vuex.js"></script>
<style>
.taskListOperator {
    text-align: right;
    margin-bottom: 1em;
}
</style>
</head>
<body>
<div id="app">
<div class="container">
<h1>Vue Todo</h1>

<div class="inputArea">
<task-form :task="newTask"></task-form>
<!-- inputArea --></div>

<hr />

<div class="taskListOperator">
<button class="btn btn-default" v-on:click="delete_click">Delete</button>
<!-- taskListOperator --></div>

<div class="list-group">
<p class="text-muted" v-show="tasks.length < 1">nothing to do.</p>
<task-item v-for="task in tasks" :task="task"></task-item>
</label>
<!-- list-group --></div>

<!-- container --></div>
<!-- app --></div>

<!-- ================================= template html ================================= -->
<script type="text/x-template" id="template-task-form">
<form v-on:submit.prevent="form_submit">
<div class="input-group">
<input class="form-control" type="text" placeholder="Buy milk 2L" v-model="task.name">
<span class="input-group-btn">
<button class="btn btn-primary">Add new task</button>
</span>
<!-- input-group --></div>
</form>
</script>

<script type="text/x-template" id="template-task-item">
<label class="list-group-item">
<span class="pull-right btn btn-link" v-on:click.prevent="edit_click">Edit</span>
<input type="checkbox" v-model="task.finished" /> {{task.name}}
</label>
</script>
<!-- ================================= /template html ================================= -->

<script>
// Vuex Store
var store = new Vuex.Store({
  state: {
    newTask: {finished: false, name: ""},
    tasks: [
      {finished: false, name: "Buy milk 2L"},
      {finished: false, name: "Call to Alice"},
      {finished: false, name: "Return book"},
    ]
  },
  mutations: {
    add: function(state){
      state.tasks.unshift(state.newTask);
      state.newTask = {finished: false, name: ""}
    },
    //おそらくdelも必要
    del: function(state){
      state.tasks = state.tasks.filter(function(v){return !v.finished})
    }
  }
})

// template定義
var taskForm = {
  template: "#template-task-form",
  props: [
    "task"/*,
    "on-submit"*/
  ],
  methods: {
    form_submit: function(event){
      if(!this.task.name){
        return;
      }
      /*this.onSubmit(event, this.task);*/
      store.commit("add");
    }
  }
}
var taskItem = {
  template: "#template-task-item",
  props: [
    "task"
  ],
  methods: {
    edit_click: function(event){
      var newName = window.prompt("Input Task.", this.task.name);
      if(typeof newName === "string"){
        this.task.name = newName;
      }
    }
  }
}

var app = new Vue({
  el: "#app",
  components: {
    taskForm: taskForm,
    taskItem: taskItem
  },
  data: store.state,
  /*data: {
    newTask:{
      name: ""
    },
    tasks: [
      {name: "Buy milk 2L"},
      {name: "Call to Alice"},
      {name: "Return book"},
    ]
  },*/
  computed: {

  },
  methods: {
    /*newTask_submit: function(event){
      this.tasks.push({name:this.newTask.name})
      this.newTask = {name: ""}
    },*/
    delete_click: function(event){
      store.commit("del");
    }
  }
})
</script>
</body>
</html>
